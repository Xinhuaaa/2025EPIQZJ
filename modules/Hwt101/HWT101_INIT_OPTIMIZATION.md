# HWT101陀螺仪初始化优化说明

## 问题描述
原始代码中，HWT101陀螺仪在开机时经常出现yaw角度自动纠偏的问题，导致初始角度不稳定。

## 解决方案
通过多次采样并去除异常值后取平均值的方式来稳定初始角度。

## 主要修改内容

### 1. 新增宏定义
```c
#define INIT_SAMPLE_COUNT 10        // 初始化采样次数
#define MAX_ANGLE_DEVIATION 30.0f   // 最大角度偏差阈值(度)
```

### 2. 新增辅助函数
- `HWT101_GetRawAngle()`: 获取原始角度值
- `HWT101_NormalizeAngle()`: 角度标准化到[-180, 180]范围
- `HWT101_CalculateFilteredAverage()`: 计算去除异常值后的平均值
- `HWT101_InitSampling()`: 初始化时进行多次采样

### 3. 优化初始化流程
1. 发送归零命令
2. 等待200ms确保归零完成
3. 进行10次数据采样
4. 去除偏差超过30度的异常值
5. 计算剩余有效值的平均值作为基准角度
6. 设置基准角度并标记初始化完成

### 4. 数据处理优化
- 添加初始化完成标志检查
- 移动校验和检查到数据处理开始
- 优化角度计算逻辑

## 工作原理

### 异常值过滤算法
1. 首先计算所有采样值的初始平均值
2. 计算每个采样值与初始平均值的偏差
3. 过滤掉偏差超过阈值的异常值
4. 用剩余有效值重新计算平均值
5. 如果有效值太少（少于总数的一半），则使用所有值

### 角度穿越处理
在计算角度偏差时，考虑了角度穿越问题（如179°到-179°的变化），确保偏差计算的准确性。

## 配置参数

可以根据实际需求调整以下参数：

- `INIT_SAMPLE_COUNT`: 增加采样次数可以提高稳定性，但会延长初始化时间
- `MAX_ANGLE_DEVIATION`: 减小阈值可以过滤更多异常值，但可能导致有效样本过少

## 使用建议

1. 确保陀螺仪在初始化期间保持静止
2. 如果环境干扰较大，可以适当增加采样次数
3. 可以通过Debug输出观察初始化过程和采样结果
4. 建议在实际使用前进行充分测试

## 调试信息

开启Debug模式（将`#define Debug 0`改为`#define Debug 1`）可以看到：
- 每次采样的角度值
- 最终的基准角度
- 有效采样数量
- 运行时的角度变化

这些信息有助于评估初始化效果和调试问题。
